<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>USG2</title>
        <meta name="viewport" content="width=device-with, initial-scale=1.0" />
        <!-- Bootstrap styles -->
        <link href="Content/bootstrap.min.css" rel="stylesheet" media="screen" />
        <!-- Kendo styles -->
        <link href="Content/kendo/2012.3.1114/kendo.common.min.css" rel="stylesheet" />
        <link href="Content/kendo/2012.3.1114/kendo.metro.min.css" rel="stylesheet" />

        <!-- JQuery -->
        <script src="Scripts/kendo/2012.3.1114/jquery.min.js"></script>
        <!-- Bootstrap -->
        <script src="Scripts/bootstrap.min.js"></script>
        <!-- Bootbox -->
        <script src="Scripts/bootbox.js"></script>
        <!-- Kendo -->
        <script src="Scripts/kendo/2012.3.1114/kendo.web.min.js"></script>
        <script src="Scripts/kendo/2012.3.1114/cultures/kendo.culture.es-ES.min.js"></script>
        <!-- Ariadna  -->
        <script src="Scripts/ariadna/ariadna.common.js"></script>
        <script src="Scripts/ariadna/ariadna.localization.es-ES.js"></script>
    </head>
    <body>
        <header>
            <!--#include file="/Menu.html" --> 
        </header>
        <div id="MainArea">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                        <h2 class="text-success">Grupos de usuarios</h2>
                    </div>
                </div>
                <div class="row-fluid">
                    <div id="grid" class="span12"></div>
                </div>
            </div>
        </div>
        <footer>

        </footer>
        <div>
        <!-- In page treatment -->
        <script type="text/x-kendo-template" id="template_new">
            <button class="k-button" onclick="ari_windowOpen('UserGroupForm.shtml');"><span class="k-icon k-i-plus"></span> Nuevo registro</button>
        </script>
        <script type="text/x-kendo-template" id="template_edit">
            <button class="k-button" onclick="ari_windowOpen('UserGroupForm.shtml?UserGroupId=#=UserGroupId#');"><span class="k-icon k-i-pencil"></span> Editar registro</button>
            <button class="k-button" onclick="test('#=UserGroupId#','UserGroup');"><span class="k-icon k-i-close"></span> Eliminar registro</button>
        </script>

        <script type="text/javascript">
            (function ($) {
                $(document).ready(function () {
                    // templates
                    var t_new = kendo.template($("#template_new").html());
                    var t_edit = kendo.template($("#template_edit").html());
                    // culture Spanish - Spain
                    kendo.culture("es-ES");
                    // building menu and bindind select event
                    $("#menu").kendoMenu({
                        select:ari_onMenuSelect
                    });
                    // remote dataSource
                    var userGroupDS = new kendo.data.DataSource({
                        transport: {
                            read: {
                                url: "http://localhost:50827/api/usergroups",
                                dataType: "json",
                                type: "GET",
                                contentType: "application/json"
                            },
                            create: {
                                url: "http://localhost:50827/api/usergroups",
                                dataType:"json",
                                type: "POST",
                                contentType: "application/json"
                            },
                            update: {
                                url: function (data) {
                                    var myUrl = "http://localhost:50827/api/usergroups/" + data.UserGroupId;
                                    return myUrl;
                                },
                                dataType: "json",
                                type: "PUT",
                                contentType: "application/json"
                            },
                            destroy: {
                                url: function (data) {
                                    return "http://localhost:50827/api/usergroups/" + data.UserGroupId;
                                },
                                dataType: "json",
                                type: "DELETE",
                                contentType: "application/json"
                            },
                            parameterMap: function (data, type) {
                                if (type != "GET")
                                    return kendo.stringify(data);
                            }
                        },
                        schema: {
                            model: {
                                id: "UserGroupId",
                                fields: {
                                    UserGroupId: { type: "number", editable: false },
                                    Name: { type: "string", editable: true, nullable: true, validation: { required: true, message: {required:"Campo requerido"} } }
                                }
                            }
                        },
                        pageSize: 10
                    });


                    var userGroupCL = [
                        { field: "UserGroupId", title: "IDM" },
                        { field: "Name", title: "Name" },
                        {
                            template:t_edit
                        }
                    ];


                    // building grid
                    $("#grid").kendoGrid({
                        dataSource:userGroupDS,
                        columns: userGroupCL,
                        toolbar: [{ text: "Nuevo registro", template: t_new }],
                        editable: "inline",
//                        editable: {update:false, destroy:true, confirmation:"¿Desea borrar este registro?"},
                        pageable: ari_pageable_es_ES,
                        sortable: true,
                        groupable: ari_groupable_es_ES,
                        filterable: ari_filterable_es_ES,
                        columnMenu: ari_columnMenu_es_ES
                    });
                });
            })(jQuery);
        </script>
        <script type="text/javascript">
            var entity;
            var id;
            function test(_id, _entitity) {
                id = _id;
                entity = _entitity;
                bootbox.confirm("<span class='lead'>¿Desea eliminar este registro?</span>", "Cancelar", "Aceptar", response);
            }
            function response(arg) {
                if (arg) {
                    var linker = ari_generalLinker(entity);
                    var url = linker.url + id;
                    var html = linker.html;
                    var options = {
                        type: 'DELETE',
                        url: url,
                        dataType: 'json',
                        success: function (data, textStatus) {
                            bootbox.alert("<span class='text-success lead'>El registro se ha borrado correctamente</span>", "Aceptar", function () { ari_windowOpen(html); });
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            var message = "<span class='text-error lead'>Se ha producido un error</span>" +
                                "<p class='text-warning'>" + jqXHR.responseText + "</p>";
                            bootbox.alert(message, "Aceptar");
                        }
                    };
                    $.ajax(options);
                }
            }
        </script>
            </div>
    </body>
</html>
