<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Main menu</title>
        <meta name="viewport" content="width=device-with, initial-scale=1.0" />
        <!-- Bootstrap styles -->
        <link href="Content/bootstrap.min.css" rel="stylesheet" media="screen" />
        <!-- Kendo styles -->
        <link href="Content/kendo/2012.3.1114/kendo.common.min.css" rel="stylesheet" />
        <link href="Content/kendo/2012.3.1114/kendo.metro.min.css" rel="stylesheet" />
        <!-- JQuery -->
        <script src="Scripts/kendo/2012.3.1114/jquery.min.js"></script>
        <!-- Bootstrap -->
        <script src="Scripts/bootstrap.min.js"></script>
        <!-- Bootbox -->
        <script src="Scripts/bootbox.js"></script>
        <!-- Kendo -->
        <script src="Scripts/kendo/2012.3.1114/kendo.web.min.js"></script>
        <script src="Scripts/kendo/2012.3.1114/cultures/kendo.culture.es-ES.min.js"></script>
        <!-- Ariadna  -->
        <script src="Scripts/ariadna/ariadna.common.js"></script>
        <script src="Scripts/ariadna/ariadna.localization.es-ES.js"></script>
    </head>
    <body>
        <header>
            <!--#include file="/Menu.html" --> 
        </header>
        <div id="MainArea">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12 lead">
                        <h2 class="text-success">Grupo de usuarios</h2>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span2">
                        <label>ID</label>
                        <input class="span12 k-text" type="text" id="txtId" readonly="true" />
                    </div>
                    <div class="span10">
                        <label>Nombre</label>
                        <input class="span12 k-text" type="text" id="txtName" required name="nombre" validationMessage="Introduzca un {0} válido"  />
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="pull-right">
                            <button class="k-button" id="accept"><span class="k-icon k-i-tick"></span> Aceptar</button>
                            <button class="k-button" id="cancel"><span class="k-icon k-i-cancel"></span> Cancelar</button>
                            <button class="k-button" id="test"><span class="k-icon k-i-custom"></span> TEST</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer>

        </footer>
        <!-- JQuery -->
        <script src="Scripts/kendo/2012.3.1114/jquery.min.js"></script>
        <!-- Bootstrap -->
        <script src="Scripts/bootstrap.min.js"></script>
        <!-- Kendo -->
        <script src="Scripts/kendo/2012.3.1114/kendo.web.min.js"></script>
        <script src="Scripts/kendo/2012.3.1114/cultures/kendo.culture.es-ES.min.js"></script>
        <!-- Ariadna  -->
        <script src="Scripts/ariadna/ariadna.common.js"></script>
        <!-- In page treatment -->
        <script type="text/javascript">
            (function ($) {
                $(document).ready(function () {
                    //
                    var userGroup = { "UserGroupId": 0, "Name": "" };
                    var isNew = true;
                    //
                    var userGroupId = gup("UserGroupId");
                    //
                    $("#txtName").focus();
                    //
                    if (userGroupId != "") {
                        isNew = false;
                        getData(userGroupId);
                    }
                    // Culture Spanish - Spain
                    kendo.culture("es-ES");
                    $("#menu").kendoMenu({
                        select:ari_onMenuSelect
                    });
                    //
                    var validator = $("#MainArea").kendoValidator().data("kendoValidator");
                    //
                    $("#test").click(function () {
                        var name = $("#txtName").val();
                        alert(name);
                    });
                    //
                    $("#accept").click(function () {
                        if (validator.validate()) {
                            var userGroup = unloadData();
                            setData(userGroup, isNew);
                        }
                    });
                    $("#cancel").click(function () {
                        ari_windowOpen("UserGroupGrid.shtml");
                    });
                });
            })(jQuery);
        </script>
        <script type="text/javascript">
            function loadData(userGroup) {
                $("#txtId").val(userGroup.UserGroupId);
                $("#txtName").val(userGroup.Name);
            }
            function getData(userGroupId) {
                var url = "http://localhost:50827/api/usergroups/" + userGroupId;
                var options = {
                    type: 'GET',
                    url: url,
                    dataType: 'json',
                    success: function (data, textStatus) {
                        loadData(data);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("JqXHR: " + kendo.stringify(jqXHR));
                        alert("Status: " + textStatus);
                        alert("ErrorThrown: " + errorThrown);
                    }
                };
                $.ajax(options);
            }
            function unloadData() {
                var userGroup = new Object();
                userGroup.UserGroupId = $("#txtId").val();
                userGroup.Name = $("#txtName").val();
                return userGroup;
            }
            function setData(userGroup, isNew) {
                var url = "http://localhost:50827/api/usergroups/";
                var type = ""
                if (isNew) {
                    type = "POST";
                } else {
                    type = "PUT";
                    url = url + userGroup.UserGroupId;
                }
                var options = {
                    type: type,
                    url: url,
                    dataType: 'json',
                    data: userGroup,
                    success: function (data, textStatus) {
                        ari_windowOpen("UserGroupGrid.shtml");
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("JqXHR: " + kendo.stringify(jqXHR));
                        alert("Status: " + textStatus);
                        alert("ErrorThrown: " + errorThrown);
                    }
                };
                $.ajax(options);
            }
        </script>
    </body>
</html>
