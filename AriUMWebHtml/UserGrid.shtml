<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Usuarios</title>
        <meta name="viewport" content="width=device-with, initial-scale=1.0" />
        <!-- Bootstrap styles -->
        <link href="Content/bootstrap.min.css" rel="stylesheet" media="screen" />
        <!-- Kendo styles -->
        <link href="Content/kendo/2012.3.1114/kendo.common.min.css" rel="stylesheet" />
        <link href="Content/kendo/2012.3.1114/kendo.metro.min.css" rel="stylesheet" />

        <!-- JQuery -->
        <script src="Scripts/kendo/2012.3.1114/jquery.min.js"></script>

        <!--[if lt IE 10]>
        <!--iecors provides a jQuery ajax custom transport for IE8/9 XDR-->
        <!--<script src="Scripts/jquery.iecors.js"></script>-->
        <script src="Scripts/xdr.js"></script>
        <![endif]-->


        <!-- Bootstrap -->
        <script src="Scripts/bootstrap.min.js"></script>
        <!-- Kendo -->
        <script src="Scripts/kendo/2012.3.1114/kendo.web.min.js"></script>
        <script src="Scripts/kendo/2012.3.1114/cultures/kendo.culture.es-ES.min.js"></script>
        <!-- Ariadna  -->
        <script src="Scripts/ariadna/ariadna.common.js"></script>
        <script src="Scripts/ariadna/ariadna.localization.es-ES.js"></script>
    </head>
    <body>
        <header>
            <!--#include file="/Menu.html" --> 
        </header>
        <div id="MainArea">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                        <h2 class="text-success">Usuarios</h2>
                    </div>
                </div>
                <div class="row-fluid">
                    <div id="grid" class="span12"></div>
                </div>
            </div>

        </div>
        <footer>

        </footer>


        <!-- In page treatment -->
        <script type="text/javascript">
            (function ($) {
                $(document).ready(function () {
                    // culture Spanish - Spain
                    kendo.culture("es-ES");
                    // building menu and bindind select event
                    $("#menu").kendoMenu({
                        select:ari_onMenuSelect
                    });
                    // remote dataSource
                    var userDS = new kendo.data.DataSource({
                        transport: {
                            read: {
                                url: "http://localhost:50827/api/users",
                                dataType: "json",
                                type: "GET",
                                contentType: "application/json"
                            },
                            create: {
                                url: "http://localhost:50827/api/users",
                                dataType:"json",
                                type: "POST",
                                contentType: "application/json"
                            },
                            update: {
                                url: function (data) {
                                    var myUrl = "http://localhost:50827/api/users/" + data.UserId;
                                    return myUrl;
                                },
                                dataType: "json",
                                type: "PUT",
                                contentType: "application/json"
                            },
                            destroy: {
                                url: function (data) {
                                    return "http://localhost:50827/api/users/" + data.UserId;
                                },
                                dataType: "json",
                                type: "DELETE",
                                contentType: "application/json"
                            },
                            parameterMap: function (data, type) {
                                if (type != "GET")
                                    return kendo.stringify(data);
                            }
                        },
                        schema: {
                            model: {
                                id: "UserId",
                                fields: {
                                    UserId: { type: "number", editable: false },
                                    Name: { type: "string", editable: true, nullable: true, validation: { required: true }},
                                    Email: { type: "string", editable: true },
                                    Password: { type: "string", editable: true },
                                    UserGroup: { filterable: false, sortable: false, defaultValue: { UserGroupId: 0, Name: "" } }
                                }
                            }
                        },
                        pageSize: 10
                    });
                    // grid columns
                    var userCL = [
                        { field: "UserId", title: "ID" },
                        { field: "Name", title: "Name"},
                        { field: "Email", title: "Email" },
                        { field: "Password", title: "Password" },
                        { field: "UserGroup", title: "Group", template: "#=UserGroup?UserGroup.Name:''#", editor: userGroupDropDownEditor },
                        {
                            command: ari_command_es_ES,
                            title: "Acciones"
                        }
                    ];
                    // building grid
                    $("#grid").kendoGrid({
                        dataSource:userDS,
                        columns: userCL,
                        toolbar: [{ name: "create", text: "Nuevo registro" }],
                        editable: "inline",
                        pageable: ari_pageable_es_ES,
                        sortable: true,
                        groupable: ari_groupable_es_ES,
                        filterable: ari_filterable_es_ES,
                        columnMenu: ari_columnMenu_es_ES
                    });
                    // UserGroup field editor
                    function userGroupDropDownEditor(container, options) {
                        $('<input required data-text-field="Name" data-value-field="UserGroupId" data-bind="value:' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            autoBind: false,
                            dataSource: {
                                transport: {
                                    read: "http://localhost:50827/api/usergroups"
                                }
                            }
                        });
                    }
                });
            })(jQuery);
        </script>
    </body>
</html>
