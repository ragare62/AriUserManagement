<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>AriUM Scaffolding</title>
        <!-- Bootstrap styles -->
        <link href="Content/bootstrap.min.css" rel="stylesheet" media="screen" />
        <!-- Kendo styles -->
        <link href="Content/kendo/2012.3.1114/kendo.common.min.css" rel="stylesheet" />
        <link href="Content/kendo/2012.3.1114/kendo.bootstrap.min.css" rel="stylesheet" />
        <!-- Ariadna styles -->
        <link href="Content/ariadna.css" rel="stylesheet" />

        <!-- JQuery -->
        <script src="Scripts/kendo/2012.3.1114/jquery.min.js"></script>
        <!-- Bootstrap -->
        <script src="Scripts/bootstrap.min.js"></script>
        <!-- Bootbox -->
        <script src="Scripts/bootbox.js"></script>
        <!-- Kendo -->
        <script src="Scripts/kendo/2012.3.1114/kendo.web.min.js"></script>
        <script src="Scripts/kendo/2012.3.1114/cultures/kendo.culture.es-ES.min.js"></script>
        <!-- Ariadna  -->
        <script src="Scripts/ariadna/ariadna.um.js"></script>
        <script src="Scripts/ariadna/ariadna.localization.es-ES.js"></script>
        <!-- Configuration via JSON -->
        <script src="config.js"></script>
    </head>
    <body>
        <header id="cabecera">
        </header>
        <div id="cuerpo" style="min-height:400px;">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                        <h3>Grupos de usuarios</h3>
                    </div>
                </div>
                <div class="row-fluid">
                    <div id="grid" class="span12"></div>
                </div>
                <div class="row-fluid">
                    <div id="form" class="span12">
                        <div class="row-fluid">
                            <div class="span2">
                                <label>ID</label>
                                <input class="span12 k-text" type="text" id="txtId" name="Id" readonly="true" />
                            </div>
                            <div class="span10">
                                <label>Nombre</label>
                                <input class="span12 k-text" type="text" id="txtName" name="Name" required validationMessage="Se necesita un nombre" />
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="pull-right">
                                <button id="accept" class="btn btn-primary" onclick="formAccept();" title="Guardar cambios">
                                    <i class="icon-ok icon-white"></i>
                                </button>
                                <button id="Button1" class="btn btn-primary" onclick="formCancel();" title="Guardar cambios">
                                    <i class="icon-arrow-left icon-white"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer id="pie">
        </footer>

        <!-- Templates -->
        <script type="text/x-kendo-template" id="template_new">
            <button class="btn btn-primary" onclick="formNew();" title="Nuevo registro">
                <i class="icon-plus icon-white"></i>
            </button>
        </script>
        <script type="tex/x-kendo-template" id="template_edit">
            <div class="pull-right">
                <button class="btn btn-primary" onclick="formEdit(#=UserGroupId#);" title="Editar registro">
                    <i class="icon-pencil icon-white"></i>
                </button>
                <button class="btn btn-primary" onclick="gridDelete(#=UserGroupId#,'#=Name#');" title="Eliminar registro">
                    <i class="icon-minus icon-white"></i>
                </button>
            </div>
        </script>
        <script type="tex/x-kendo-template" id="template_editS">
            <div class="pull-right">
                <button class="btn btn-primary" onclick="grid_select(#=UserGroupId#,'UserGroup');" title="Seleccionar registro">
                    <i class="icon-asterisk icon-white"></i>
                </button>
                <button class="btn btn-primary" onclick="grid_edit(#=UserGroupId#,'UserGroup');" title="Editar registro">
                    <i class="icon-pencil icon-white"></i>
                </button>
                <button class="btn btn-primary" onclick="grid_delete(#=UserGroupId#,'UserGroup','#=Name#');" title="Eliminar registro">
                    <i class="icon-minus icon-white"></i>
                </button>
            </div>
        </script>
        <script type="text/javascript">
            (function ($) {
                $(document).ready(function () {
                    //
                    cargaCabeceraPie();
                    // set title
                    document.title = "Grupos de usuarios";
                    // 
                    showGrid();
            
                    // building grid
                    $("#grid").kendoGrid({
                        dataSource: gridDS,
                        columns: gridCL,
                        toolbar: [{template: t_new }],
                        pageable: ari_pageable_es_ES,
                        sortable: true,
                        groupable: ari_groupable_es_ES,
                        filterable: ari_filterable_es_ES,
                        columnMenu: ari_columnMenu_es_ES
                    });
                });
            })(jQuery);
        </script>
        <script type="text/javascript">
            /*
            ---------------------------------------
            General variables 
            ---------------------------------------
            */
            var isNew = false; //
            var deleteId = 0;
            // Load url parameters
            var mode = gup("mode");
        </script>
        <script type="text/javascript">
            /*
            ---------------------------------------
            Grid related fields
            ---------------------------------------
            */

            // Load templates
            var t_new = kendo.template($("#template_new").html());
            var t_edit = kendo.template($("#template_edit").html());
            if (mode == "S")
                t_edit = kendo.template($("#template_editS").html());
            // Grid datasource
            var gridDS = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: controller_url.userGroups,
                        dataType: "json",
                        type: "GET",
                        contentType: "application/json"
                    },
                    parameterMap: function (data, type) {
                        if (type != "GET")
                            return kendo.stringify(data);
                    }
                },
                schema: {
                    model: {
                        id: "UserGroupId",
                        fields: {
                            UserGroupId: { type: "number" },
                            Name: { type: "string"}
                        }
                    }
                },
                pageSize: 5
            });
            // Grid columns
            var gridCL = [
                { field: "UserGroupId", title: "ID" },
                { field: "Name", title: "Name" }, {
                    template: t_edit
                }
            ];
        </script>
        <script type="text/javascript">
            /*
            ---------------------------------------
            Grid management functions
            ---------------------------------------
            */
            function gridRefresh() {
                var ds = $("#grid").data("kendoGrid").dataSource;
                var totalPages = ds.totalPages();
                ds.read();
                if (isNew) ds.page(totalPages);
            }
            function gridDelete(id, name) {
                deleteId = id;
                bootbox.confirm("<h4>¿Desea eliminar este registro? (" + name + ")</h4>", "Cancelar", "Aceptar", deleteResponse);
            }
            function deleteResponse(arg) {
                if (arg) {
                    var url = controller_url.userGroups + deleteId;
                    var options = {
                        type: 'DELETE',
                        url: url,
                        dataType: 'json',
                        success: function (data, textStatus) {
                            gridRefresh();
                        }
                    };
                    $.ajax(options);
                }
            }
        </script>
        <script type="text/javascript">
            /*
            -----------------------------------------
            General page function
            -----------------------------------------
            */
            // Show the grid div and hides the form one
            function showGrid() {
                $("#grid").show();
                $("#form").hide();
            }
            // shows the form div and hides the grid one
            function showForm() {
                $("#form").show();
                $("#grid").hide();
            }
        </script>
        <script type="text/javascript">
            /*
            ---------------------------------------
            Form management functions
            ---------------------------------------
            */
            function formNew() {
                isNew = true;
                $("#txtId").val("");
                $("#txtName").val("");
                showForm();
                $("#txtName").focus();
            }
            function formEdit(id) {
                isNew = false;
                var url = controller_url.userGroups + id;
                var options = {
                    type: 'GET',
                    url: url,
                    dataType: 'json',
                    success: function (data, textStatus) {
                        formLoadData(data);
                        showForm();
                        $("#txtName").focus();
                    }
                };
                $.ajax(options);
            }
            function formAccept() {
                var validator = $("#form").kendoValidator().data("kendoValidator");
                if (validator.validate()) {
                    var UserGroup = formUnloadData();
                    var url = controller_url.userGroups;
                    var type = "";
                    if (isNew)
                        type = "POST";
                    else {
                        type = "PUT";
                        url += UserGroup.UserGroupId;
                    }
                    var options = {
                        type: type,
                        url: url,
                        dataType: 'json',
                        data: UserGroup,
                        success: function (data, textStatus) {
                            gridRefresh();
                            showGrid();
                        }
                    }
                    $.ajax(options);
                }
            }
            function formCancel() {
                showGrid();
            }
            function formUnloadData() {
                var UserGroup = new Object();
                UserGroup.UserGroupId = $("#txtId").val();
                UserGroup.Name = $("#txtName").val();
                return UserGroup;
            }
            function formLoadData(UserGroup) {
                $("#txtId").val(UserGroup.UserGroupId);
                $("#txtName").val(UserGroup.Name);
            }
        </script>
    </body>
</html>
    